generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ============ ENUMS ============
enum Role {
  SUPER_ADMIN
  REGISTRAR
  TEACHER
  STUDENT
}

enum Gender {
  MALE
  FEMALE
}

enum StudentStatus {
  APPLICANT
  ADMITTED
  ENROLLED
  NOT_ENROLLED
  GRADUATED
  DROPPED
}

enum CourseType {
  RECORDED
  LIVE
}

enum PriceType {
  ONE_TIME
  MONTHLY
  YEARLY
}

// ============ MODELS ============

// User - for authentication
model User {
  id                String   @id @default(cuid())
  userId            String   @unique // ADMIN-001, STU-20250001, etc.
  email             String?  @unique
  password          String
  role              Role
  mustChangePassword Boolean @default(true)
  profileComplete   Boolean  @default(false)
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  profile  Profile?
  student  Student?
  teacher  Teacher?
  registrar Registrar?
}

// Profile - personal information
model Profile {
  id         String   @id @default(cuid())
  userId     String   @unique
  firstName  String
  lastName   String
  middleName String?
  gender     Gender?
  birthDate  DateTime?
  phone      String?
  address    String?
  avatar     String?
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
}

// Student record
model Student {
  id         String        @id @default(cuid())
  userId     String        @unique
  studentId  String        @unique // STU-20250001
  status     StudentStatus @default(APPLICANT)
  createdAt  DateTime      @default(now())
  updatedAt  DateTime      @updatedAt

  user        User         @relation(fields: [userId], references: [id], onDelete: Cascade)
  enrollments Enrollment[]
}

// Teacher record
model Teacher {
  id         String   @id @default(cuid())
  userId     String   @unique
  teacherId  String   @unique // TEA-20250001
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  user    User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  courses Course[]
}

// Registrar record
model Registrar {
  id          String   @id @default(cuid())
  userId      String   @unique
  registrarId String   @unique // REG-20250001
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
}

// ID Sequence tracker
model IdSequence {
  id        String   @id @default(cuid())
  type      String   // STUDENT, TEACHER, REGISTRAR
  year      Int
  lastNumber Int     @default(0)
  
  @@unique([type, year])
}

// ============ PROGRAM MODELS ============

// Program - created by admin
model Program {
  id          String    @id @default(cuid())
  name        String
  description String?
  price       Float     @default(0)
  priceType   PriceType @default(ONE_TIME)
  image       String?   // URL for card image
  isActive    Boolean   @default(true)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  
  courses     Course[]
}

// ============ COURSE MODELS ============

// Course - created by teacher
model Course {
  id          String     @id @default(cuid())
  name        String
  description String?
  type        CourseType @default(RECORDED)
  teacherId   String
  programId   String?
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt

  teacher     Teacher      @relation(fields: [teacherId], references: [id], onDelete: Cascade)
  program     Program?     @relation(fields: [programId], references: [id], onDelete: SetNull)
  modules     Module[]
  enrollments Enrollment[]
}

// Module - sections within a course
model Module {
  id        String   @id @default(cuid())
  name      String
  order     Int      @default(0)
  courseId  String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  course  Course   @relation(fields: [courseId], references: [id], onDelete: Cascade)
  lessons Lesson[]
}

// Lesson - individual lessons within a module
model Lesson {
  id          String    @id @default(cuid())
  name        String
  description String?
  materials   String?   // URLs to materials (comma separated or JSON)
  videoUrl    String?   // For RECORDED courses - YouTube link
  zoomLink    String?   // For LIVE courses - Zoom/Meet link
  scheduledAt DateTime? // For LIVE courses - when the live class is
  order       Int       @default(0)
  moduleId    String
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  module Module @relation(fields: [moduleId], references: [id], onDelete: Cascade)
}

// Enrollment - student enrolled in a course
model Enrollment {
  id        String   @id @default(cuid())
  studentId String
  courseId  String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  student Student @relation(fields: [studentId], references: [id], onDelete: Cascade)
  course  Course  @relation(fields: [courseId], references: [id], onDelete: Cascade)

  @@unique([studentId, courseId])
}
